# 智慧簽單及派工系統需求說明書#### 預期效益
- **效率提升**：預計可減少 50% 的文件處理時間
- **成本節省**：減少紙本印製與儲存成本
- **錯誤減少**：透過數位化流程，降低人工輸入錯誤
- **客戶滿意度**：提供更快速的簽收流程與即時的電子憑證
- **環保貢獻**：減少紙本使用，響應環保
- **使用者接受度**：透過優化介面與流程，提高司機對系統的接受度

#### 使用者體驗目標
- **簡化司機操作**：將複雜的資料輸入工作轉移至後台處理
- **直覺操作**：設計符合司機使用習慣的介面
- **降低學習門檻**：提供容易上手的操作流程
- **減少重複工作**：自動填充常用資訊文件資訊
| 項目 | 內容 |
|------|------|
| 文件版本 | 1.0 |
| 日期 | 2025年09月14日 |
| 專案名稱 | 智慧簽單及派工系統 |
| 文件狀態 | 草稿 |
| 預計完成日期 | 待定 |
| 文件維護者 | 待定 |

## 1. 簡介 (Introduction)

### 1.1 目的與價值 (Purpose and Value)
本文件旨在闡述開發一套智慧簽單及派工系統的需求。該系統將優化現行的司機送貨簽收流程，從紙本作業轉向數位化，提升作業效率並改善資料管理，以利後續的財務報表製作。

#### 預期效益
- **效率提升**：預計可減少 50% 的文書處理時間
- **成本節省**：減少紙本印製與儲存成本
- **錯誤減少**：透過數位化流程，降低人工輸入錯誤
- **客戶滿意度**：提供更快速的簽收流程與即時的電子憑證
- **環保貢獻**：減少紙本使用，響應環保

### 1.2 現行作業流程痛點 (Current Process Pain Points)
- 司機需攜帶紙本簽單至客戶端，請客戶簽收
- 部分客戶需要簽單副本，導致紙本作業量增加
- 已簽收的紙本簽單需帶回公司
- 公司人員需手動將紙本簽單資訊鍵入系統，以產生財務報表，此過程耗時且易出錯

### 1.3 使用者角色 (User Roles)

#### 主要使用者
- **司機**：系統的主要操作者，負責執行送貨與簽收作業
- **客戶**：需要在行動裝置上進行簽名確認的終端使用者
- **後台管理人員**：負責處理財務報表與系統管理的內部人員

#### 使用情境
- **司機**：需要行動裝置友善的介面，可在戶外環境順暢操作
- **客戶**：需要直覺的簽名介面，無需特別訓練即可使用
- **後台人員**：需要完整的資料管理與報表產生功能

## 2. 系統需求 (System Requirements)

### 2.1 需求優先級別說明

| 優先級別 | 說明 |
|---------|------|
| P0 | 必要功能，系統上線必須完成 |
| P1 | 重要功能，應於首次發布前完成 |
| P2 | 次要功能，可於後續更新中提供 |

### 2.2 核心功能 - 簽單管理 (Core Functionality - Delivery Note Management) [P0]

#### 2.1.1 簽單內容與時間管理 (Delivery Note Content and Time Management) [P0]

##### a) 基本欄位需求
- **必填欄位**：
  - 日期：工作執行日期 (YYYY/MM/DD)
  - 客戶名稱：服務對象公司名稱
  - 施工地點：實際作業地址
  - 作業狀況：工作內容描述
  - 工作時間：
    - 開始時間 (HH:mm)
    - 結束時間 (HH:mm)
    - 總工時（系統自動計算）
  - 客戶簽章：客戶簽名確認區
  - 金額：此次服務費用

- **選填欄位**：
  - 備註：額外說明事項
  - 機具：可多選機械設備

- **自動帶入欄位**：
  - 車號：執行工作車輛編號
  - 司機姓名：依登入者資訊
  - 總工時：根據開始和結束時間計算

##### b) 時間管理功能
- **時間記錄方式**：
  - 精確記錄開始與結束時間
  - 24小時制時間格式 (HH:mm)
  - 支援一鍵記錄當前時間

- **工時計算**：
  - 自動計算並即時顯示總工時
  - 精確度至小數點後一位（如：3.5小時）
  - 跨日計算支援

##### c) 資料格式規範
- **時間格式**：24小時制（HH:mm）
- **金額**：新台幣，自動加入千分位符號
- **工時**：小數點後一位，單位為小時
### 2.2 司機端功能與優化 (Driver-side Functionality and Optimization)

#### 2.2.0 登入與身份驗證 [P0]
- **LINE 整合登入**：
  - 使用 LINE 帳號進行身份驗證
  - 簡化登入流程，避免記憶額外帳號密碼
  - 確保工作指派準確性

#### 2.2.1 機具管理系統 [P0]
- **機具選擇功能**：
  - 多重選擇介面
  - 常用機具快速選項
  - 支援臨時新增機具
  - 離線狀態下可用

- **機具資料管理**：
  - 機具清單維護
  - 使用狀態追蹤
  - 使用頻率統計

- **同步機制**：
  - 後台更新自動同步至前端
  - 新增臨時機具同步至後台
  - 定期更新使用統計

- **快速選單**：
  - 提供常用作業狀況描述
  - 機具使用情況快速選擇
  - 常用備註範本

- **智慧填充**：
  - 自動帶入車號與司機資訊
  - 智慧時間填寫（可一鍵記錄開始/結束時間）
  - 依客戶自動帶入慣用施工地點
  - 支援地址自動完成功能
#### 2.1.2 簽名方式 (Signature Method)
- **客戶簽名**：客戶應能直接在行動裝置上（如手機）進行簽名確認
- **驗證方式**：系統需接受手寫簽名作為憑證
- **不接受方式**：不接受以拍照或語音口述作為簽收證明

#### 2.1.3 簽單格式與副本 (Delivery Note Format and Copies) [P0]
- **簽單版面配置**：
  - 清晰的欄位排版，符合使用習慣
  - 適合手機螢幕顯示的響應式設計
  - 關鍵資訊（日期、客戶、金額）需特別醒目

- **數位化副本**：
  - 提供PDF格式下載
  - 支援電子郵件直接發送給客戶
  - 系統自動保存歷史簽單

- **實體列印需求**：
  - 支援標準A4尺寸列印
  - 提供精簡版與詳細版兩種列印格式
  - 可選擇是否列印金額欄位

### 2.2 司機端功能 (Driver-side Functionality)

#### 2.2.1 行程記錄 (Journey Recording)
- 司機需能記錄每次任務的**出發地點**及**結束地點**
- **不需要**計算行程距離

#### 2.2.3 工作內容記錄 (Work Content Recording) [P0]
- **實際作業記錄**：
  - 司機僅需填寫實際作業時間
  - 記錄實際施工狀況與異常情形
  - 提供預設選項快速選擇

- **彈性輸入方式**：
  - 支援語音輸入
  - 提供文字鍵盤輸入
  - 設計快速選單減少輸入量

- **異常狀況處理**：
  - 提供常見異常狀況選項
  - 支援照片上傳功能
  - 快速通報機制

#### 2.2.4 客戶簽收 (Customer Sign-off)
- 系統需提供界面供客戶直接在司機的行動裝置上完成簽名

### 2.3 後端管理功能 (Back-end Management Functionality)

#### 2.3.1 機具管理功能
- **基本管理**：
  - 新增/編輯機具資訊
  - 設定機具啟用狀態
  - 管理機具類別

- **使用統計**：
  - 機具使用率報表
  - 使用時數統計
  - 異常使用警示

#### 2.3.2 報表功能
- **工時分析**：
  - 依客戶統計工時
  - 依機具類型統計
  - 工時異常警示

#### 2.3.3 財報資訊整合
- 簽單資訊自動轉換
- 機具使用成本計算
- 工時費用自動統計

## 3. 技術架構 (Technical Architecture)

### 3.1 前端架構 (Frontend Architecture)

#### 3.1.1 核心框架 (Core Framework)
- **Blazor WebAssembly**
  - 使用 .NET 7.0 或以上版本
  - PWA （Progressive Web App）支援
  - 離線功能實現

#### 3.1.2 前端元件 (Frontend Components)
- **UI 元件庫**
  - Blazorise 或 MudBlazor
  - 自訂組件庫
- **狀態管理**
  - Fluxor 狀態管理
  - 本地儲存 (LocalStorage)

### 3.2 Firebase 服務架構 (Firebase Services)

#### 3.2.1 Firebase Authentication
- **驗證方式**
  - LINE 登入
  - 電子郵件/密碼
  - 手機驗證

#### 3.2.2 Cloud Firestore
- **核心集合**：
  - 簽單集合 (deliveryNotes)：
    ```typescript
    interface DeliveryNote {
      id: string;
      date: Date;
      customerName: string;
      location: string;
      workTime: {
        startTime: Date;
        endTime: Date;
        totalHours: number;
      };
      machines: MachineUsage[];
      vehicleNumber: string;
      driverName: string;
      amount: number;
      notes: string;
      signature: string;
    }
    ```
  - 機具集合 (machines)：
    ```typescript
    interface Machine {
      id: string;
      name: string;
      isActive: boolean;
      lastUsed: Date;
      usageCount: number;
      category: string;
    }
    ```
  - 使用者集合 (users)
  - 客戶資料 (customers)
  - 工作記錄 (workLogs)

#### 3.2.3 Cloud Storage
- **儲存結構**
  - 簽名圖片
  - 工作照片
  - 簽單 PDF

#### 3.2.4 Cloud Functions
- **觸發器功能**
  - 簽單狀態更新
  - PDF 產生
  - 推播通知
  - 資料備份

#### 3.2.5 Firebase Hosting
- **部署設定**
  - HTTPS 安全連線
  - CDN 加速
  - 自動部署流程

#### 3.2.6 Cloud Messaging
- **推播通知類型**
  - 新工作通知
  - 簽單狀態更新
  - 系統公告

### 3.3 整合架構 (Integration Architecture)

#### 3.3.1 API 介面
- **Firebase SDK 整合**
  - 使用 Firebase .NET SDK
  - 實作服務層封裝

#### 3.3.2 資料同步
- **離線資料處理**
  - IndexedDB 本地儲存
  - 資料同步機制
  - 衝突解決策略

## 4. 非功能性需求 (Non-functional Requirements)

### 4.1 效能需求 (Performance Requirements)
- **應用程式效能**
  - 簽單上傳時間不得超過 3 秒
  - 簽單查詢響應時間應在 1 秒內
  - 首次載入時間須在 3 秒內

- **系統負載**
  - 系統應同時支援至少 50 位司機同時連線使用
  - Firestore 讀寫操作每秒不超過 1000 次

- **離線效能**
  - 支援離線儲存至少 1000 筆簽單
  - 離線資料同步時間不超過 5 秒

### 4.2 安全性需求 (Security Requirements)
- **傳輸安全**
  - 所有資料傳輸必須使用 HTTPS 加密
  - 實作 JWT 驗證機制

- **資料安全**
  - 使用 Firebase 內建的身分驗證機制
  - 實作 Firestore 安全規則
  - 資料定期備份至 Cloud Storage

- **應用程式安全**
  - 簽單資料防竄改機制
  - 實作操作日誌記錄
  - 定期安全審計

### 3.3 相容性需求 (Compatibility Requirements)
- 支援 Android 7.0 以上版本
- 支援 iOS 12 以上版本
- 支援主流瀏覽器最新版本（Chrome、Firefox、Safari）

### 3.4 可用性需求 (Usability Requirements)
- **介面要求**：
  - 系統介面必須支援中文
  - 按鈕尺寸須適合手指點選（建議至少 44x44 像素）
  - 戶外陽光下畫面須清晰可讀

- **操作流程**：
  - 從開啟應用到完成簽單不得超過 3 個步驟
  - 常用功能須在兩次點擊內可達
  - 提供手勢操作支援（如滑動切換）

- **離線支援**：
  - 必須提供離線操作功能
  - 自動同步機制，網路恢復後自動上傳
  - 本地暫存至少支援 100 張簽單

