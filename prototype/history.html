<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>智慧簽單系統 - 歷史紀錄</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">
  <link href="styles/common.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container-fluid">
    <div class="row">
      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
          <h1 class="h2">簽單歷史紀錄</h1>
        </div>

        <div class="card">
          <div class="card-body">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>日期</th>
                  <th>客戶名稱</th>
                  <th>地點</th>
                  <th>金額</th>
                  <th>狀態</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="historyTable"></tbody>
            </table>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Bootstrap Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Firebase & Firestore 讀取 -->
  <script type="module">
    import { db } from "./firebase-init.js";
    import { collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore.js";

    async function loadHistory() {
      const tbody = document.getElementById("historyTable");
      tbody.innerHTML = "";

      const q = query(collection(db, "deliveryNotes"), orderBy("createdAt", "desc"));
      const snapshot = await getDocs(q);

      snapshot.forEach(doc => {
        const d = doc.data();
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${doc.id}</td>
          <td>${d.date || "-"}</td>
          <td>${d.customer || "-"}</td>
          <td>${d.location || "-"}</td>
          <td>NT$ ${d.amount || "0"}</td>
          <td><span class="badge bg-success">已完成</span></td>
          <td><button class="btn btn-sm btn-outline-primary"><i class="bi bi-eye"></i></button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    loadHistory();
  </script>
</body>
</html>
